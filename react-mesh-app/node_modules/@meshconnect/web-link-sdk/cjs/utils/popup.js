"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addPopup = exports.removePopup = exports.iframeId = void 0;
var style_1 = require("./style");
var popupId = 'mesh-link-popup';
var backdropId = 'mesh-link-popup__backdrop';
var popupContentId = 'mesh-link-popup__popup-content';
var stylesId = 'mesh-link-popup__styles';
exports.iframeId = 'mesh-link-popup__iframe';
var getPopupHtml = function (link) { return "\n<div id=\"".concat(popupId, "\">\n  <div id=\"").concat(backdropId, "\"></div>\n  <div id=\"").concat(popupContentId, "\">\n    <iframe id=\"").concat(exports.iframeId, "\" src=\"").concat(link, "\" allow=\"clipboard-read *; clipboard-write *\" />\n  </div>\n</div>\n"); };
var getStyles = function (style) { return "\n<style id=\"".concat(stylesId, "\">\n  body {\n    position: fixed;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    overflow: hidden;\n  }\n\n  #").concat(popupId, " {\n    all: unset;\n    position: fixed;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n  }\n\n  #").concat(backdropId, " {\n    position: absolute;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    z-index: 10000;\n    background: black;\n    opacity: ").concat((0, style_1.getNumber)(0.6, style === null || style === void 0 ? void 0 : style.io), ";\n  }\n\n  #").concat(popupContentId, " {\n    position: absolute;\n    height: 80%;\n    max-height: 710px;\n    min-height: 685px;\n    margin: auto;\n    z-index: 10001;\n    width: 30%;\n    max-width: 430px;\n    min-width: 380px;\n    display: flex;\n    flex-direction: column;\n    border-radius: ").concat((0, style_1.getNumber)(24, style === null || style === void 0 ? void 0 : style.ir), "px;\n    background: white;\n    flex-grow: 1;\n  }\n\n  #").concat(popupContentId, " iframe {\n    border: none;\n    width: 100%;\n    flex-grow: 1;\n    border-radius: ").concat((0, style_1.getNumber)(24, style === null || style === void 0 ? void 0 : style.ir), "px;\n  }\n\n  @media only screen and (max-width: 768px) {\n    #").concat(popupContentId, " {\n      height: 100vh;\n      width: 100vw;\n      max-width: 100%;\n      min-width: 100%;\n      max-height: 100%;\n      min-height: 100%;\n      border-radius: 0px;\n    }\n\n    #").concat(popupContentId, " iframe {\n      border-radius: 0px;\n    }\n  }\n\n  @media only screen and (max-height: 710px) {\n    #").concat(popupContentId, " {\n      max-height: 100%;\n      min-height: 100%;\n    }\n  }\n</style>\n"); };
function removePopup() {
    var _a, _b;
    var existingPopup = window.document.getElementById(popupId);
    (_a = existingPopup === null || existingPopup === void 0 ? void 0 : existingPopup.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(existingPopup);
    var existingStyles = window.document.getElementById(stylesId);
    (_b = existingStyles === null || existingStyles === void 0 ? void 0 : existingStyles.parentElement) === null || _b === void 0 ? void 0 : _b.removeChild(existingStyles);
}
exports.removePopup = removePopup;
function addPopup(iframeLink) {
    var style = (0, style_1.getLinkStyle)(iframeLink);
    removePopup();
    var popup = getPopupHtml(iframeLink);
    var stylesElement = htmlToElement(getStyles(style));
    if (stylesElement) {
        window.document.head.appendChild(stylesElement);
    }
    var popupElement = htmlToElement(popup);
    if (popupElement) {
        window.document.body.appendChild(popupElement);
    }
}
exports.addPopup = addPopup;
function htmlToElement(html) {
    var template = document.createElement('template');
    html = html.trim();
    template.innerHTML = html;
    return template.content.firstChild;
}
